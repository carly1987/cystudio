<% include ../head.html %>
<% include nav.html %>
<div class="container-fluid">
<div class="row">
	<% include sidebar.html %>
	<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
		<h1 class="page-header"></h1>
		<ul class="nav nav-tabs" role="tablist">
			<li role="presentation" class="active"><a href="#postAuto" aria-controls=="postAuto" role="tab" data-toggle="tab">自动回复</a></li>
			<li role="presentation"><a href="#postFirst" aria-controls=="postFirst" role="tab" data-toggle="tab">首次关注时自动回复</a></li>
			<li role="presentation"><a href="#postkey" aria-controls=="postkey" role="tab" data-toggle="tab">关键字回复规则</a></li>
		</ul>
		<%if(success){%>
		<div class="alert alert-success" role="alert"><%= success%></div>
		<%}%>
		<%if(error){%>
		<div class="alert alert-danger" role="alert"><%= error%></div>
		<%}%>
		<div class="tab-content tab-padding">
			<div role="tabpanel" class="tab-pane active" id="postAuto">
				<form method="post" action='postAuto' class="form-horizontal" role="form">
					<div class="form-group">
						<div class="col-sm-5">
							<textarea name="autoMessage" class="form-control"><%= doc.autoMessage%></textarea>
						</div>
					</div>
					<div class="form-group">
						<div class="col-sm-10">
							<button type="submit" class="btn btn-primary">保存</button>
						</div>
					</div>
				</form>
			</div>
			<div role="tabpanel" class="tab-pane" id="postFirst">
				<form method="post" action='postFirst' class="form-horizontal" role="form">
					<div class="form-group">
						<div class="col-sm-5">
							<textarea name="firstMessage" class="form-control"><%= doc.firstMessage%></textarea>
						</div>
					</div>
					<div class="form-group">
						<div class="col-sm-5">
							<button type="submit" class="btn btn-primary">保存</button>
						</div>
					</div>
				</form>
			</div>
			<div role="tabpanel" class="tab-pane" id="postkey">
				<div class="row">
					<div class="col-md-6">
						<table class="table table-striped">
							<thead>
								<tr>
									<th>规则名</th>
									<th>关键字</th>
									<th>回复</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody>
								<% list.forEach(function(v){ %>
								<tr>
									<td><a href="/admin/key?id=<%= v._id%>#postkey"><%= v.name%></a></td>
									<td><%= v.keys%></td>
									<td>
										<%= v.fed%>
										<%if(v.article){%>
											<a href="/app/article?id=<%= v.article['_id']%>"><%= v.article['title']%></a>
										<%}%>
									</td>
									<td><a href="/admin/key/del?id=<%= v._id%>#postkey">删除</a></td>
								</tr>
								<% }) %>
							</tbody>
						</table>
					</div>
					<div class="col-md-6">
						<div class="panel panel-default">
							<div class="panel-heading">
								<h3 class="panel-title">添加/编辑 规则</h3>
							</div>
							<div class="panel-body">
								<%if(success){%>
								<div class="alert alert-success" role="alert"><%= success%></div>
								<%}%>
								<%if(error){%>
								<div class="alert alert-danger" role="alert"><%= error%></div>
								<%}%>
								<form class="form-horizontal" role="form" method='post' action="postKey">
									<div class="form-group">
										<label for="keyName" class="col-sm-2 control-label">规则名</label>
										<div class="col-sm-9">
											<input type="text" class="form-control" name="keyName" value="">
										</div>
									</div>
									<div class="form-group">
										<label for="keyKeys" class="col-sm-2 control-label">关键字</label>
										<div class="col-sm-9">
											<input type="text" class="form-control" name="keyKeys">
										</div>
									</div>
									<div class="form-group">
										<label for="keyFedByTxt" class="col-sm-2 control-label">回复</label>
										<div class="col-sm-9">
											<div class="panel-group" id="accordionFed" role="tablist" aria-multiselectable="true">
												<div class="panel panel-default">
													<div class="panel-heading" role="tab" id="headingOne">
														<h4 class="panel-title">
															<a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
																文本回复
															</a>
														</h4>
													</div>
													<div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
														<div class="panel-body">
															<textarea name="fed" class="form-control"></textarea>
														</div>
													</div>
												</div>
												<div class="panel panel-default">
													<div class="panel-heading" role="tab" id="headingTwo">
														<h4 class="panel-title">
															<a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
																图文信息回复
															</a>
														</h4>
													</div>
													<div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
														<div class="panel-body">
															<select multiple class="form-control" name="article" id="keyFedBySelect"></select>
														</div>
													</div>
												</div>
												<div class="panel panel-default">
													<div class="panel-heading" role="tab" id="headingThree">
														<h4 class="panel-title">
															<a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
																用功能库回复
															</a>
														</h4>
													</div>
													<div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
														<div class="panel-body">
															<select multiple class="form-control" name="fn" id="keyFedByFN">
																<option value="/app/wsite">微官网</option>
															</select>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
									<div class="form-group">
										<div class="col-sm-offset-2 col-sm-9">
											<button type="submit" class="btn btn-primary">保存</button>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</div>
<% include ../foot.html %>